<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faculty Dashboard</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #007BFF;
            color: white;
            padding: 10px 20px;
            text-align: center;
        }
        section {
            margin: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }
        th {
            background-color: #007BFF;
            color: white;
        }
        input, button, textarea {
            margin: 5px;
            padding: 8px;
        }
        textarea {
            width: 95%;
            height: 100px;
        }
    </style>
</head>
<body>
<header>
    <h1>Faculty Dashboard</h1>
</header>

<section>
    <h2>Courses Taught</h2>
    <table id="courses-table">
        <thead>
        <tr>
            <th>Course Name</th>
            <th>Semester</th>
            <th>Description</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
    <button onclick="fetchCourses()">Refresh Courses</button>
</section>

<section>
    <h2>Add a Quiz</h2>
    <form id="quiz-form">
        <input type="text" id="courseId" placeholder="Course ID" required>
        <input type="text" id="quizTitle" placeholder="Quiz Title" required>
        <input type="number" id="quizDuration" placeholder="Duration (in minutes)" required>
        <input type="checkbox" id="isGraded">
        <label for="isGraded">Is Graded?</label>
        <button type="button" onclick="addQuiz()">Add Quiz</button>
    </form>
</section>

<section>
    <h2>Update Syllabus</h2>
    <form id="syllabus-form">
        <input type="text" id="courseIdForSyllabus" placeholder="Course ID" required>
        <textarea id="syllabusContent" placeholder="Enter syllabus details" required></textarea>
        <button type="button" onclick="updateSyllabus()">Update Syllabus</button>
    </form>
</section>

<section>
    <h2>Post an Announcement</h2>
    <form id="announcement-form">
        <input type="text" id="courseIdForAnnouncement" placeholder="Course ID" required>
        <textarea id="announcementText" placeholder="Enter announcement" required></textarea>
        <button type="button" onclick="postAnnouncement()">Post Announcement</button>
    </form>
</section>

<script>
    const baseUrl = '/api/faculty';
    const facultyId = '6638500f7feb0c76a296319e'; // This should be dynamically assigned

    function getCsrfToken() {
        const cookies = document.cookie.split(';');
        let csrfToken = '';
        cookies.forEach(cookie => {
            const parts = cookie.split('=');
            if (parts[0].trim() === 'XSRF-TOKEN') {
                csrfToken = parts[1];
            }
        });
        return csrfToken;
    }

    function fetchCourses() {
        fetch(`${baseUrl}/${facultyId}/courses`)
            .then(response => response.json())
            .then(courses => {
                const table = document.getElementById('courses-table').getElementsByTagName('tbody')[0];
                table.innerHTML = ''; // Clear existing rows
                courses.forEach(course => {
                    const row = table.insertRow();
                    row.insertCell().textContent = course.name;
                    row.insertCell().textContent = course.semester;
                    row.insertCell().textContent = course.description;
                });
            })
            .catch(error => {
                console.error('Error fetching courses:', error);
                alert('Failed to fetch courses. Please check the console for errors.');
            });
    }

    function addQuiz() {
        const courseId = document.getElementById('courseId').value;
        const title = document.getElementById('quizTitle').value;
        const duration = parseInt(document.getElementById('quizDuration').value, 10);
        const isGraded = document.getElementById('isGraded').checked;

        const quizData = {
            title,
            duration,
            isGraded,
            questions: [] // Assuming questions need to be dynamically added or managed differently
        };

        fetch(`${baseUrl}/course/${courseId}/quizzes`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-XSRF-TOKEN': getCsrfToken() // CSRF token header
            },
            body: JSON.stringify(quizData)
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Failed to add quiz.');
                }
            })
            .then(data => {
                alert('Quiz added successfully!');
                console.log(data);
            })
            .catch(error => {
                console.error('Failed to add quiz:', error);
                alert(error.message);
            });
    }

    function updateSyllabus() {
        const courseId = document.getElementById('courseIdForSyllabus').value;
        const syllabusContent = document.getElementById('syllabusContent').value;

        fetch(`${baseUrl}/course/${courseId}/syllabus`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-XSRF-TOKEN': getCsrfToken() // CSRF token header
            },
            body: JSON.stringify({ syllabusContent })
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Failed to update syllabus.');
                }
            })
            .then(data => {
                alert('Syllabus updated successfully!');
                console.log(data);
            })
            .catch(error => {
                console.error('Failed to update syllabus:', error);
                alert(error.message);
            });
    }

    function postAnnouncement() {
        const courseId = document.getElementById('courseIdForAnnouncement').value;
        const announcement = document.getElementById('announcementText').value;

        fetch(`${baseUrl}/course/${courseId}/announcements`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-XSRF-TOKEN': getCsrfToken() // CSRF token header
            },
            body: JSON.stringify({ announcement })
        })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error('Failed to post announcement.');
                }
            })
            .then(data => {
                alert('Announcement posted successfully!');
                console.log(data);
            })
            .catch(error => {
                console.error('Failed to post announcement:', error);
                alert(error.message);
            });
    }

    // Initial fetch on page load
    window.onload = fetchCourses;
</script>
</body>
</html>
